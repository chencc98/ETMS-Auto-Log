<?xml version="1.0" encoding="utf-8"?>
<mx:Label xmlns:mx="http://www.adobe.com/2006/mxml" text="Detail" creationComplete="init()">
    <mx:Script>
        <![CDATA[
            
            import mx.managers.PopUpManager;
            import entity.ProjectStatus;
            import ui.ProjectDetail;
            import ui.ProjectDetailWrap;
            import utils.ProjectRefreshEvent;
            import mx.controls.Alert;
            
            private var projectDetail:ProjectDetail;
            
            private function init():void{
                this.addEventListener(MouseEvent.CLICK, openDetail);
            }
            

            //open a pop-up to see the detail
            private function openDetail(event:MouseEvent):void {
                projectDetail = ProjectDetailWrap.getProjectDetailUI();
                PopUpManager.addPopUp(projectDetail, this.owner, true);
                //Mypopup.x = Capabilities.screenResolutionX/2 - Mypopup.width/2;
                //Mypopup.y = Capabilities.screenResolutionY/2 - Mypopup.height/2;
                PopUpManager.centerPopUp(projectDetail);
                
                projectDetail.projectId.text = data.id;
                projectDetail.projectName.text = data.name;
                projectDetail.client.text = data.client;
                projectDetail.projectStatus.text = data.status;
                projectDetail.progress.text = data.progress;
                projectDetail.progress.enabled = false;
                projectDetail.deleteEmployee.enabled = false;
                projectDetail.addEmployee.enabled = false;
                projectDetail.editButton.enabled = true;
                projectDetail.editButton.visible = true;
                projectDetail.submitButton.enabled = false;
                projectDetail.submitButton.visible = false;
                
                //if the project is complete, edit is not allowed
                if (data.status == ProjectStatus.COMPLETE) {
                    projectDetail.editButton.enabled = false;
                }
                
                //as the initial step, load the employees under this project
                projectDetail.loadEmployee();
                
//                if (!projectDetail.hasEventListener(ProjectRefreshEvent.REFRESH_EVENT)){
                projectDetail.addEventListener(ProjectRefreshEvent.REFRESH_EVENT, loadMaindata);
//                }
    
                
            }
            
            private function closePopup():void {
                projectDetail.removeEventListener(ProjectRefreshEvent.REFRESH_EVENT, loadMaindata);
                PopUpManager.removePopUp(projectDetail);
            }
            private function loadMaindata(event:ProjectRefreshEvent):void{
                closePopup();
                if (event.whatToDo == ProjectRefreshEvent.DO_REFRESH){
                    this.dispatchEvent(event);
                }
            }

            
        ]]>
    </mx:Script>
    
</mx:Label>
